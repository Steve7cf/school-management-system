<%- include('../../partials/messages') %>

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0">Edit Student</h2>
                <div class="btn-group">
                    <a href="/students" class="btn btn-outline-secondary">
                        <img src="/class.png" alt="Back" style="width: 20px; height: 20px;" class="me-2">
                        Back to List
                    </a>
                    <a href="/students/<%= student._id %>" class="btn btn-outline-primary">
                        <img src="/view.png" alt="View" style="width: 20px; height: 20px;" class="me-2">
                        View Details
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title mb-0">Edit Student</h4>
                </div>
                <div class="card-body">
                    <form action="/students/edit/<%= student._id %>" method="POST">
                        <!-- Personal Information -->
                        <div class="mb-4">
                            <h5 class="text-primary">Personal Information</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">First Name</label>
                                    <input type="text" name="firstName" class="form-control" value="<%= student.firstName %>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Last Name</label>
                                    <input type="text" name="lastName" class="form-control" value="<%= student.lastName %>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Date of Birth</label>
                                    <input type="date" name="dateOfBirth" class="form-control" 
                                           value="<%= student.dateOfBirth ? (new Date(student.dateOfBirth)).toISOString().split('T')[0] : '' %>" 
                                           required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Gender</label>
                                    <input type="text" class="form-control" value="<%= student.gender || 'Not Set' %>" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Section</label>
                                    <select name="section" class="form-select" required>
                                        <option value="">Select Section</option>
                                        <option value="A" <%= student.section === 'A' ? 'selected' : '' %>>A</option>
                                        <option value="B" <%= student.section === 'B' ? 'selected' : '' %>>B</option>
                                        <option value="C" <%= student.section === 'C' ? 'selected' : '' %>>C</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Academic Information -->
                        <div class="mb-4">
                            <h5 class="text-primary">Academic Information</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Admission Number</label>
                                    <input type="text" name="studentId" class="form-control" value="<%= student.studentId %>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Class</label>
                                    <input type="text" class="form-control" value="<%= student.gradeLevel ? 'Form ' + student.gradeLevel : 'Not Assigned' %><%= student.section ? ' Section ' + student.section : '' %>" readonly>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="mb-4">
                            <h5 class="text-primary">Contact Information</h5>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label">Address</label>
                                    <textarea name="address" class="form-control" rows="3"><%= student.address || '' %></textarea>
                                </div>
                            </div>
                        </div>

                        <% if (!parent) { %>
                        <!-- Parent/Guardian Information -->
                        <div class="mb-4">
                            <h5 class="text-primary">Parent/Guardian Information</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Parent/Guardian Name</label>
                                    <input type="text" name="guardianName" class="form-control" value="<%= student.guardian && student.guardian.name ? student.guardian.name : '' %>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Relationship</label>
                                    <select name="guardianRelation" class="form-select" required>
                                        <option value="">Select Relationship</option>
                                        <option value="Father" <%= student.guardian && student.guardian.relation === 'Father' ? 'selected' : '' %>>Father</option>
                                        <option value="Mother" <%= student.guardian && student.guardian.relation === 'Mother' ? 'selected' : '' %>>Mother</option>
                                        <option value="Guardian" <%= student.guardian && student.guardian.relation === 'Guardian' ? 'selected' : '' %>>Guardian</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Parent/Guardian Phone</label>
                                    <input type="tel" name="guardianPhone" class="form-control" value="<%= student.guardian && student.guardian.phone ? student.guardian.phone : '' %>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Parent/Guardian Email</label>
                                    <input type="email" name="guardianEmail" class="form-control" value="<%= student.guardian && student.guardian.email ? student.guardian.email : '' %>">
                                </div>
                            </div>
                        </div>
                        <% } %>

                        <% if (parent) { %>
                        <div class="mb-4">
                            <h5 class="text-primary">Linked Parent Account</h5>
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Parent Name</label>
                                    <input type="text" class="form-control" value="<%= parent.firstName %> <%= parent.lastName %>" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Parent Email</label>
                                    <input type="email" class="form-control" value="<%= parent.email %>" readonly>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Parent Phone</label>
                                    <input type="text" class="form-control" value="<%= parent.phone %>" readonly>
                                </div>
                            </div>
                        </div>
                        <% } %>

                        <div class="mb-4">
                            <h5 class="text-primary">Subjects</h5>
                            <div class="row g-3">
                                <div class="col-12">
                                    <label class="form-label">Assign Subjects</label>
                                    <select name="subjects" class="form-select" multiple size="6">
                                        <% if (subjects && subjects.length > 0) { %>
                                            <% subjects.forEach(subject => { %>
                                                <option value="<%= subject._id %>"
                                                    <%= student.subjects && student.subjects.includes(subject._id.toString()) ? 'selected' : '' %>>
                                                    <%= subject.name %> (<%= subject.code %>)
                                                </option>
                                            <% }); %>
                                        <% } %>
                                    </select>
                                    <small class="text-muted">Hold Ctrl (Windows) or Command (Mac) to select multiple subjects.</small>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="/students" class="btn btn-secondary">Cancel</a>
                            <button type="submit" class="btn btn-primary">Update Student</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border: none;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    border-radius: 10px;
}

.form-control,
.form-select {
    border-radius: 5px;
    border: 1px solid #dee2e6;
    padding: 0.5rem 1rem;
}

.form-control:focus,
.form-select:focus {
    border-color: #80bdff;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
}

.card-title {
    color: #495057;
    font-weight: 600;
    margin-bottom: 1.5rem;
}

.btn-group .btn {
    display: inline-flex;
    align-items: center;
}

.btn-group .btn img {
    opacity: 0.7;
}

.btn-group .btn:hover img {
    opacity: 1;
}
</style> 